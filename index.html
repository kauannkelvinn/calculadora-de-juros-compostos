<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Juros Compostos</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Calculadora de Juros Compostos</h1>
            <p class="text-md text-gray-600 mt-2">Veja a mágica dos juros compostos em ação e planeje seu futuro financeiro.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Formulário de Entrada -->
            <div class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-lg">
                <form id="investment-form">
                    <h2 class="text-2xl font-semibold mb-6">Parâmetros do Investimento</h2>
                    <div class="space-y-5">
                        <div>
                            <label for="initial-investment" class="block text-sm font-medium text-gray-700 mb-1">Valor Inicial (R$)</label>
                            <input type="number" id="initial-investment" value="1000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        </div>
                        <div>
                            <label for="monthly-contribution" class="block text-sm font-medium text-gray-700 mb-1">Aporte Mensal (R$)</label>
                            <input type="number" id="monthly-contribution" value="500" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        </div>
                        <div>
                            <label for="interest-rate" class="block text-sm font-medium text-gray-700 mb-1">Taxa de Juros Anual (%)</label>
                            <input type="number" id="interest-rate" value="10" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        </div>
                        <div>
                            <label for="period" class="block text-sm font-medium text-gray-700 mb-1">Período (anos)</label>
                            <input type="number" id="period" value="20" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mt-8 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 ease-in-out">
                        Calcular Projeção
                    </button>
                </form>
            </div>

            <!-- Resultados e Gráfico -->
            <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 text-center">Projeção de Crescimento</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 text-center">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-sm font-medium text-gray-500">Valor Final</h3>
                        <p id="final-amount" class="text-2xl font-bold text-blue-600">R$ 0,00</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-sm font-medium text-gray-500">Total Investido</h3>
                        <p id="total-invested" class="text-2xl font-bold text-gray-700">R$ 0,00</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-sm font-medium text-gray-500">Total em Juros</h3>
                        <p id="total-interest" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                    </div>
                </div>
                <div class="w-full h-80 md:h-96">
                    <canvas id="investment-chart"></canvas>
                </div>
            </div>
        </main>
    </div>

    <script>
        const form = document.getElementById('investment-form');
        const finalAmountEl = document.getElementById('final-amount');
        const totalInvestedEl = document.getElementById('total-invested');
        const totalInterestEl = document.getElementById('total-interest');
        const chartCanvas = document.getElementById('investment-chart');

        let investmentChart;

        // Função para formatar números como moeda brasileira
        const formatCurrency = (value) => {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        // Função para calcular os juros compostos
        const calculateCompoundInterest = (initial, monthly, rate, years) => {
            const monthlyRate = rate / 100 / 12;
            const months = years * 12;
            let total = initial;
            
            const history = [{ year: 0, total, invested: initial }];
            let totalInvested = initial;

            for (let i = 1; i <= months; i++) {
                total += monthly;
                totalInvested += monthly;
                total *= (1 + monthlyRate);

                // Adiciona um ponto de dados a cada ano para o gráfico
                if (i % 12 === 0 || i === months) {
                    history.push({
                        year: i / 12,
                        total,
                        invested: totalInvested
                    });
                }
            }
            
            const totalInterest = total - totalInvested;
            
            return {
                finalAmount: total,
                totalInvested: totalInvested,
                totalInterest: totalInterest,
                history: history
            };
        };

        // Função para renderizar/atualizar o gráfico
        const renderChart = (history) => {
            const labels = history.map(item => `Ano ${Math.round(item.year)}`);
            const totalData = history.map(item => item.total);
            const investedData = history.map(item => item.invested);

            const data = {
                labels: labels,
                datasets: [
                    {
                        label: 'Valor Total com Juros',
                        data: totalData,
                        borderColor: '#2563eb', // blue-600
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.3,
                    },
                    {
                        label: 'Valor Apenas Investido',
                        data: investedData,
                        borderColor: '#4b5563', // gray-600
                        backgroundColor: 'rgba(75, 85, 99, 0.1)',
                        fill: false,
                        tension: 0.3,
                        borderDash: [5, 5],
                    }
                ]
            };
            
            // Destroi o gráfico antigo se ele existir
            if (investmentChart) {
                investmentChart.destroy();
            }

            // Cria um novo gráfico
            investmentChart = new Chart(chartCanvas, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value, index, values) {
                                    return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        };

        // Função principal que lida com o cálculo e a atualização da UI
        const handleCalculation = (e) => {
            if(e) e.preventDefault();

            // Pega os valores do formulário
            const initialInvestment = parseFloat(document.getElementById('initial-investment').value);
            const monthlyContribution = parseFloat(document.getElementById('monthly-contribution').value);
            const interestRate = parseFloat(document.getElementById('interest-rate').value);
            const period = parseFloat(document.getElementById('period').value);
            
            // Validação simples
            if (isNaN(initialInvestment) || isNaN(monthlyContribution) || isNaN(interestRate) || isNaN(period)) {
                alert("Por favor, preencha todos os campos com valores válidos.");
                return;
            }

            // Calcula os resultados
            const results = calculateCompoundInterest(initialInvestment, monthlyContribution, interestRate, period);

            // Atualiza os cards de resultado
            finalAmountEl.textContent = formatCurrency(results.finalAmount);
            totalInvestedEl.textContent = formatCurrency(results.totalInvested);
            totalInterestEl.textContent = formatCurrency(results.totalInterest);
            
            // Renderiza o gráfico
            renderChart(results.history);
        };

        // Adiciona o evento de submit ao formulário
        form.addEventListener('submit', handleCalculation);
        
        // Realiza um cálculo inicial ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
             handleCalculation();
        });

    </script>
</body>
</html>
